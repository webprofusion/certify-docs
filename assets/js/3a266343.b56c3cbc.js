"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5509],{20980:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"deployment/tasks/ccs","title":"Using Centralized Certificate Store (CCS) on Windows","description":"IIS on Windows has a feature called Centralized Certificate Store (CCS) which lets IIS load the latest certificates it needs from a local path or network share. This is useful when you need to share certificates across multiple IIS web servers, or if you want to centralize renewals on one server and copy the certs to other servers.","source":"@site/docs/deployment/tasks/ccs.md","sourceDirName":"deployment/tasks","slug":"/deployment/tasks/ccs","permalink":"/docs/deployment/tasks/ccs","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/deployment/tasks/ccs.md","tags":[],"version":"current","frontMatter":{}}');var t=i(74848),r=i(28453);const o={},c="Using Centralized Certificate Store (CCS) on Windows",l={},a=[{value:"Basic Guide to Configuring IIS CCS",id:"basic-guide-to-configuring-iis-ccs",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Step-by-Step Configuration",id:"step-by-step-configuration",level:3},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Known Issues",id:"known-issues",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"using-centralized-certificate-store-ccs-on-windows",children:"Using Centralized Certificate Store (CCS) on Windows"})}),"\n",(0,t.jsxs)(n.p,{children:["IIS on Windows has a feature called ",(0,t.jsx)(n.em,{children:"Centralized Certificate Store"})," (CCS) which lets IIS load the latest certificates it needs from a local path or network share. This is useful when you need to share certificates across multiple IIS web servers, or if you want to centralize renewals on one server and copy the certs to other servers."]}),"\n",(0,t.jsxs)(n.p,{children:["An advantage with this approach is that the IIS binding configurations themselves are not updated, which avoids application recycling/reloads which can happen when the IIS ",(0,t.jsx)(n.code,{children:"applicationhost.config"})," is touched by the Web Administration library which updates IIS certificate bindings."]}),"\n",(0,t.jsx)(n.h2,{id:"basic-guide-to-configuring-iis-ccs",children:"Basic Guide to Configuring IIS CCS"}),"\n",(0,t.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A supported version of Windows Server"}),"\n",(0,t.jsx)(n.li,{children:"IIS 8.0 or later with CCS feature installed"}),"\n",(0,t.jsxs)(n.li,{children:["Network share accessible by all IIS servers as UNC path e.g. ",(0,t.jsx)(n.code,{children:"\\\\server01\\certificates\\"})]}),"\n",(0,t.jsx)(n.li,{children:"Proper permissions on certificate store location"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step-by-step-configuration",children:"Step-by-Step Configuration"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Install CCS Feature"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use the Windows Server feature administration UI to enable the CCS feature for IIS."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Create Network Share"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create a shared folder on a server"}),"\n",(0,t.jsx)(n.li,{children:"Grant read permissions to IIS application pool identities"}),"\n",(0,t.jsx)(n.li,{children:"Grant read/write to the machine or account which will be renewing/writing the certificate. When using the machine identity you may prefer to create a security group and add the machine to that group."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Configure CCS via IIS Manager"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Open IIS Manager"}),"\n",(0,t.jsx)(n.li,{children:"Select server node"}),"\n",(0,t.jsx)(n.li,{children:'Double-click "Centralized Certificates"'}),"\n",(0,t.jsx)(n.li,{children:"Enable feature and specify UNC path"}),"\n",(0,t.jsx)(n.li,{children:"Provide credentials for accessing the share"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Alternatively configure via PowerShell:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:'Set-IISCentralCertProvider -CertStoreLocation "\\\\server\\certificates" \n                           -UserName "domain\\user" \n                           -Password "password" \n                           -Enabled $true\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Certificate Conventions"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Certificates must be named using the FQDN (e.g., ",(0,t.jsx)(n.code,{children:"www.example.com.pfx"}),"). The Certify ",(0,t.jsx)(n.em,{children:"Deploy to CCS"})," task will take care of naming the files correctly."]}),"\n",(0,t.jsxs)(n.li,{children:["Private key password should be consistent across certificates. To set a certificate password in Certify use ",(0,t.jsx)(n.em,{children:"Certificate > Advanced > Signing & Security > Password"}),". The password takes effect when you next renew the certificate and the certificate PFX file is rebuilt."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Configure the Managed Certificate to export to the CCS store location"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["On your existing managed certificate:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Set a PFX password under Certificate > Advanced > Signing & Security > Password."}),"\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.em,{children:"Deployment Mode"})," on the ",(0,t.jsx)(n.em,{children:"Deployment"})," tab to ",(0,t.jsx)(n.em,{children:"No Deployment"})," or ",(0,t.jsx)(n.em,{children:"Store Only"}),". This is to avoid attempting to update the IIS bindings outside of CCS."]}),"\n",(0,t.jsxs)(n.li,{children:["Under ",(0,t.jsx)(n.em,{children:"Tasks > Deployment Tasks"}),", add a ",(0,t.jsx)(n.em,{children:"Deploy to CCS task"}),", configure the output share path. The task will decide the output filename naming scheme depending on the domains etc."]}),"\n",(0,t.jsx)(n.li,{children:"Run your renewal to generate your new PFX and export it to your share path. If all credentials were correct you will find the PFX file has been exported to the share path ready for use."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Binding Configuration"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'When creating HTTPS bindings in IIS, select "Use Centralized Certificate Store" and specify the Hostname. As normal you should avoid specifying IP address bindings and instead use "All Unassigned" and enable SNI.'}),"\n",(0,t.jsxs)(n.li,{children:["If you have previously been using directly updated HTTPS bindings edit or recreate the HTTPS binding in IIS. In Certify, set Deployment Mode to ",(0,t.jsx)(n.em,{children:"No Deployment"})," or ",(0,t.jsx)(n.em,{children:"Store Only"}),", otherwise it will try to update the IIS binding."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use a dedicated service account with minimal required permissions to access the share."}),"\n",(0,t.jsx)(n.li,{children:"Implement proper network security for certificate store access"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"known-issues",children:"Known Issues"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If the IIS UI cannot read the private key of a certificate the UI will show an exclamation mark, however this is normal as IIS itself should still be able to access the key, unless the PFX password is mismatched."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify network connectivity to certificate store"}),"\n",(0,t.jsx)(n.li,{children:"Check event logs for CCS-related errors"}),"\n",(0,t.jsx)(n.li,{children:"Validate service account permissions"}),"\n",(0,t.jsx)(n.li,{children:"Confirm certificate naming matches hostname in bindings"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var s=i(96540);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);