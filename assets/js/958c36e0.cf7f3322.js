"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7994],{45011:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"http-validation","title":"HTTP Domain Validation (http-01)","description":"Why use HTTP Validation?","source":"@site/docs/http-validation.md","sourceDirName":".","slug":"/http-validation","permalink":"/docs/http-validation","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/http-validation.md","tags":[],"version":"current","frontMatter":{"id":"http-validation","title":"HTTP Domain Validation (http-01)"},"sidebar":"commonDocsSidebar","previous":{"title":"Certificate Authorities","permalink":"/docs/guides/certificate-authorities"},"next":{"title":"DNS Domain Validation (dns-01)","permalink":"/docs/dns/validation"}}');var o=n(74848),a=n(28453);const r={id:"http-validation",title:"HTTP Domain Validation (http-01)"},s=void 0,l={},c=[{value:"Why use HTTP Validation?",id:"why-use-http-validation",level:2},{value:"How to use HTTP Validation (on Windows)",id:"how-to-use-http-validation-on-windows",level:2},{value:"How Http Validation works",id:"how-http-validation-works",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"Timeout during http validation",id:"timeout-during-http-validation",level:3},{value:"HTTP domain validations suddenly failing",id:"http-domain-validations-suddenly-failing",level:3},{value:"Error 500, 404 or 403 (or other http error code)",id:"error-500-404-or-403-or-other-http-error-code",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"why-use-http-validation",children:"Why use HTTP Validation?"}),"\n",(0,o.jsx)(t.p,{children:"To request a certificate from Let's Encrypt (or any Certificate Authority), you must prove control of the domain names on the certificate. Two ACME challenge types are commonly used:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"http-01"})," \u2013 validation over HTTP"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"dns-01"})," \u2013 ",(0,o.jsx)(t.a,{href:"/docs/dns/validation",children:"validation over DNS"})," (TXT records)"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"Wildcard certificates"})," (for example, ",(0,o.jsx)(t.code,{children:"*.yourdomain.com"}),") can only be requested using DNS validation. DNS validation is also useful when:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Your domains are not public websites."}),"\n",(0,o.jsx)(t.li,{children:"Port 80 (HTTP) cannot be used for validation."}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"how-to-use-http-validation-on-windows",children:"How to use HTTP Validation (on Windows)"}),"\n",(0,o.jsxs)(t.p,{children:["When the Certificate Authority performs domain validation over http (known as an ",(0,o.jsx)(t.code,{children:"http-01"})," challenge) they ask for a randomly named text file to be presented in the ",(0,o.jsx)(t.code,{children:"/.well-known/acme-challenge"})," path of your website. So they should be able to retrieve it at ",(0,o.jsx)(t.code,{children:"http://<yourdomain>/.well-known/acme-challenge/<filename>"})]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Your server must be able to respond on TCP port 80 in order to perform any HTTP validation. If your firewall blocks port 80 (or blocks requests from other countries etc), unblock it to proceed. You don't need IIS http bindings as by default the app will use it's own http challenge response server."})}),"\n",(0,o.jsx)(t.p,{children:"If this step succeeds, you're all set to automatically complete HTTP validation of your domain. Once completed, the Certificate Authority marks your domain (associated with your account) as 'valid' and we can then proceed with requesting the final certificate."}),"\n",(0,o.jsx)(t.h3,{id:"how-http-validation-works",children:"How Http Validation works"}),"\n",(0,o.jsxs)(t.p,{children:["With ",(0,o.jsx)(t.em,{children:"Certify Certificate Manager"}),", we attempt to answer the http challenge using the built-in ",(0,o.jsx)(t.a,{href:"/docs/http-challenge-server",children:"Http Challenge Server"})," and as a fallback we use IIS (or whichever webserver is configured for port 80 http traffic, if any) by automatically detecting the website folder to write the challenge response file to, or by writing to the website path you provide in your configuration (for Apache etc)."]}),"\n",(0,o.jsxs)(t.p,{children:["On ",(0,o.jsx)(t.em,{children:"IIS"})," this process presents a few challenges, which the app attempts to fix automatically:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"The file does not have an extension (like .txt etc), so a static file handler usually needs to be configured to handle extension-less files"}),"\n",(0,o.jsx)(t.li,{children:"Existing handlers for extension-less content may intercept the request and prevent access to the file"}),"\n",(0,o.jsx)(t.li,{children:"If authentication (basic, forms etc) is enabled the access to the file will be restricted so this needs to be disabled"}),"\n",(0,o.jsxs)(t.li,{children:["Due to the above, ",(0,o.jsx)(t.code,{children:"Asp.Net"})," (and an app-pool) is generally required so that web.config can be supplied to override the configuration."]}),"\n",(0,o.jsx)(t.li,{children:"Other customizations or app requirements for the parent website may affect configuration"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"So in the event that we cannot automatically provide the challenge response and fallback to IIS, we attempt to auto-configure the required configuration without modifying the configuration of the parent web application, this avoids app restarts for the parent application."}),"\n",(0,o.jsxs)(t.p,{children:["We create a file called ",(0,o.jsx)(t.strong,{children:"configcheck"})," in the ",(0,o.jsx)(t.code,{children:"/.well-known/acme-challenge"})," folder and we cycle through a number of alternative web.config options and test each one. The testing process then makes a local http request to your website at ",(0,o.jsx)(t.code,{children:"http://<yourdomain>/.well-known/acme-challenge/configcheck"})]}),"\n",(0,o.jsxs)(t.p,{children:["If the local request fails (perhaps because the local server can't resolve itself via DNS etc) and if proxy API support is enabled, the app asks\nthe ",(0,o.jsx)(t.a,{href:"https://api.certifytheweb.com",children:"https://api.certifytheweb.com"})," server if it can access the resource instead (which also has the benefit of being external, just like the Let's Encrypt server is)."]}),"\n",(0,o.jsx)(t.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,o.jsx)(t.h3,{id:"timeout-during-http-validation",children:"Timeout during http validation"}),"\n",(0,o.jsxs)(t.p,{children:["Your firewall is blocking port 80. Open port TCP 80 in Windows Firewall and on any cloud hosting firewall rules you have. Validation will occurs from multiple geographic locations, so if you need geographic blocking only block specific countries, or if you have an application-aware firewall allow all incoming http requests to ",(0,o.jsx)(t.code,{children:"/.well-known/acme-challenge"})]}),"\n",(0,o.jsx)(t.h3,{id:"http-domain-validations-suddenly-failing",children:"HTTP domain validations suddenly failing"}),"\n",(0,o.jsxs)(t.p,{children:['If you find you are unexpectedly getting HTTP domain validation failures (particularly "Secondary validation") the most common cause is a Firewall blocking TCP port 80 (http) or you are blocking a range of IP or Geographic locations. To allow only your CAs HTTP validation requests through we recommend using a Web Application Firewall set to allow all http requests to any path starting with ',(0,o.jsx)(t.code,{children:"/.well-known/acme-challenge/"}),". Alternatively block specific countries instead of blocking all countries, as your CA (the default being Let's Encrypt) may choose to validate from any geographic region."]}),"\n",(0,o.jsx)(t.h3,{id:"error-500-404-or-403-or-other-http-error-code",children:"Error 500, 404 or 403 (or other http error code)"}),"\n",(0,o.jsx)(t.p,{children:"The most common problem is that auto configuration has failed to determine the best config for your system. Different editions/distributions of windows have different defaults."}),"\n",(0,o.jsx)(t.p,{children:"1 - Check the challenge folder exists"}),"\n",(0,o.jsxs)(t.p,{children:["Check that configcheck file has been created at: ",(0,o.jsx)(t.code,{children:"wwwwroot\\inetpub\\*yourwebsite*\\.well-known\\acme-challenge"})]}),"\n",(0,o.jsx)(t.p,{children:"If not, check your folder permissions allow this folder/files to be created. If necessary, check the website root path is correctly mapped."}),"\n",(0,o.jsx)(t.p,{children:"2 - Check you can access"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"http://*yourdomain*/.well-known/acme-challenge/configcheck"})}),"\n",(0,o.jsxs)(t.p,{children:["If the file exists on disk but you get an error ",(0,o.jsx)(t.strong,{children:"404"})," (not found) accessing the file then you have a problem with mapping extensionless files to static content."]}),"\n",(0,o.jsxs)(t.p,{children:["If you get an error ",(0,o.jsx)(t.strong,{children:"500"})," (server error), the web.config probably has a directive your server can't support. If the web.config has a ",(0,o.jsx)(t.code,{children:"<clear/>"})," directive, try removing it."]}),"\n",(0,o.jsxs)(t.p,{children:["If you get an error ",(0,o.jsx)(t.strong,{children:"403"})," (access denied), your web application is denying access to the challenge response file, probably because the parent web application requires authentication. Your web.config in the ",(0,o.jsx)(t.code,{children:"/acme-challenge/"})," folder should include the following directive:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'    <system.web>\n        <authorization>\n        <allow users="*" />\n        </authorization>\n    </system.web>\n'})}),"\n",(0,o.jsxs)(t.p,{children:["In addition you may need to modify the web.config of the parent web application to allow access to the ",(0,o.jsx)(t.code,{children:"/.well-known/acme-challenge"})," folder:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<configuration>\n...\n...\n  <location path=".well-known/acme-challenge">\n    <system.web>\n       <authorization>\n          <allow users="*"/>\n       </authorization>\n    </system.web>\n  </location>\n ...\n ...\n</configuration>\n'})}),"\n",(0,o.jsxs)(t.p,{children:["The use of a web.config file to control web application configuration requires ",(0,o.jsx)(t.code,{children:"Asp.Net"})," to be installed alongside IIS."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>s});var i=n(96540);const o={},a=i.createContext(o);function r(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);