"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4244],{30569:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"hub/guides/acme-server","title":"Managed ACME Service","description":"Summary","source":"@site/docs/hub/guides/acme-server.md","sourceDirName":"hub/guides","slug":"/hub/guides/acme-server","permalink":"/docs/hub/guides/acme-server","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/hub/guides/acme-server.md","tags":[],"version":"current","frontMatter":{"title":"Managed ACME Service"},"sidebar":"hubDocSidebar","previous":{"title":"Managed Challenges","permalink":"/docs/hub/guides/managedchallenges"},"next":{"title":"Certify Certificate Manager (Desktop)","permalink":"/docs/hub/guides/ccm"}}');var a=i(74848),r=i(28453);const l={title:"Managed ACME Service"},s=void 0,c={},o=[{value:"Summary",id:"summary",level:2},{value:"Example",id:"example",level:3},{value:"Set up your Managed Challenge",id:"set-up-your-managed-challenge",level:2},{value:"Creating EAB Credentials",id:"creating-eab-credentials",level:3},{value:"Set up your ACME client",id:"set-up-your-acme-client",level:3},{value:"Limitations and Known Issues",id:"limitations-and-known-issues",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(n.p,{children:["The Hub API can provide a simple ACME service ",(0,a.jsx)(n.em,{children:"(currently experimental)"})," which proxies certificate orders to real Certificate Authorities and takes care of domain validation on behalf of the calling ACME client."]}),"\n",(0,a.jsx)(n.p,{children:"This means you can point any ACME client at the Hub ACME directory URL, ask it to complete HTTP domain validation (or none at all), and the hub will transparently order the corresponding certificate and complete domain validation on the client's behalf using a matching pre-configured Managed Challenge."}),"\n",(0,a.jsx)(n.p,{children:"If your ACME client supports External Account Binding (EAB), this can be used to identify and authorize the client."}),"\n",(0,a.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,a.jsxs)(n.p,{children:["If you control a domain like ",(0,a.jsx)(n.code,{children:"projectbids.co.uk"})," and want to create a certificate for ",(0,a.jsx)(n.code,{children:"internal-app.projectbids.co.uk"})," from another device, that device may have an ACME client but can't answer ACME HTTP/DNS challenges itself (or you may not want it to). In that case, you can use the hub to:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Configure a Managed Challenge so the hub knows how to update the target domain's DNS zone."}),"\n",(0,a.jsx)(n.li,{children:"Set up EAB credentials for your ACME client to identify itself to the hub, and authorize it to use the required Managed Challenge."}),"\n",(0,a.jsx)(n.li,{children:"Configure your ACME client to use the Hub ACME API, providing the EAB credentials to identify itself to the hub during ACME account creation."}),"\n",(0,a.jsx)(n.li,{children:"Configure a new certificate in your ACME client with a domain/identifier matching the Managed Challenge."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"set-up-your-managed-challenge",children:"Set up your Managed Challenge"}),"\n",(0,a.jsxs)(n.p,{children:["Configure a ",(0,a.jsx)(n.a,{href:"/docs/hub/guides/managedchallenges",children:"Managed Challenge"})," in the hub to answer challenges for your target domain."]}),"\n",(0,a.jsx)(n.h3,{id:"creating-eab-credentials",children:"Creating EAB Credentials"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Under Settings > Users, create an application security principal to represent your ACME client (e.g., ",(0,a.jsx)(n.em,{children:"Example ACME Client on firewall-01"}),"). Assign the role ",(0,a.jsx)(n.em,{children:"Managed ACME Consumer"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Under API Access, select Add API Token. Provide a descriptive title (e.g., ",(0,a.jsx)(n.em,{children:"Example ACME EAB Credentials"}),"), select the security principal you created, and scope the token to the ",(0,a.jsx)(n.em,{children:"Managed ACME Consumer"})," role."]}),"\n",(0,a.jsxs)(n.li,{children:["Select ",(0,a.jsx)(n.em,{children:"View as EAB"})," against the credential, then copy the displayed values for use in your ACME client during initial ACME account creation."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"set-up-your-acme-client",children:"Set up your ACME client"}),"\n",(0,a.jsx)(n.p,{children:"In your ACME client of choice (on any device that can communicate with the hub API):"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Configure the client to use the ",(0,a.jsx)(n.code,{children:"<your Hub API URL>/acme/directory"})," ACME service and provide the EAB credentials you have created."]}),"\n",(0,a.jsx)(n.li,{children:"The ACME client will register a new account against the ACME service."}),"\n",(0,a.jsx)(n.li,{children:"You can then order a new certificate for identifiers matching your Managed Challenge that you configured in the hub."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"limitations-and-known-issues",children:"Limitations and Known Issues"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'This method of "proxying" ACME orders is non-standard and may not work with every ACME client. It relies on ACME clients allowing authorizations to be instantly valid, but the order itself taking some time to process.'}),"\n",(0,a.jsx)(n.li,{children:"The choice of actual ACME CA used for the real certificate order depends on the hub's default CA selection. The client cannot currently indicate a preference; in the future, this may be possible using ACME profiles."}),"\n",(0,a.jsx)(n.li,{children:"The temporary hub-managed certificate created for the order will be discarded as soon as the client downloads the final certificate. It will not participate in ACME ARI, etc., and automated renewal will depend on the client."}),"\n",(0,a.jsx)(n.li,{children:"Currently ACME EAB support is required for account creation."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>s});var t=i(96540);const a={},r=t.createContext(a);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);