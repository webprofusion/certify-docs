"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3694],{68277:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"hub/guides/managedchallenges","title":"Managed Challenges","description":"Introduction","source":"@site/docs/hub/guides/managedchallenges.md","sourceDirName":"hub/guides","slug":"/hub/guides/managedchallenges","permalink":"/docs/hub/guides/managedchallenges","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/hub/guides/managedchallenges.md","tags":[],"version":"current","frontMatter":{"id":"managedchallenges","title":"Managed Challenges"},"sidebar":"hubDocSidebar","previous":{"title":"Known Issues","permalink":"/docs/hub/known-issues"},"next":{"title":"Managed ACME Service","permalink":"/docs/hub/guides/acme-server"}}');var s=i(74848),a=i(28453);const l={id:"managedchallenges",title:"Managed Challenges"},r=void 0,c={},o=[{value:"Introduction",id:"introduction",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Define a Managed Challenge configuration",id:"define-a-managed-challenge-configuration",level:3},{value:"Configure API Access",id:"configure-api-access",level:3},{value:"2. Create an API Key to use the managed challenge",id:"2-create-an-api-key-to-use-the-managed-challenge",level:3},{value:"Combined Hub joining and Managed Challenge Key",id:"combined-hub-joining-and-managed-challenge-key",level:4},{value:"Configure your ACME Client",id:"configure-your-acme-client",level:3}];function d(e){const n={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"A managed challenge provides a way for the management hub to perform ACME challenge responses on behalf of other ACME clients. This is useful for DNS based challenges, so that your ACME clients (including Certify Certificate Manager) don't need to know privileged credentials with direct access to your DNS API."}),"\n",(0,s.jsx)(n.admonition,{title:"feature under development",type:"warning",children:(0,s.jsx)(n.p,{children:"This feature is under development and documentation may refer to features and procedures that are not yet available."})}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsxs)(n.p,{children:['When you perform a certificate request on any ACME client, the CA will ask your ACME client to prepare a particular "challenge response" (an ',(0,s.jsx)(n.code,{children:"_acme-challenge"})," TXT record) in your domains DNS. Your ACME client will call the Management Hub API with details of the record to be created and the hub will create the record on it's behalf."]}),"\n",(0,s.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,s.jsx)(n.p,{children:"To use a managed challenge you need two things:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A configuration for the managed challenge. This will specify which DNS provider and credentials will be used and importantly it will specify the matching domains the challenge configuration can be used for with a Domain Match Rule."}),"\n",(0,s.jsx)(n.li,{children:"An assigned API Token allowing access to use managed challenges. This will be used by your ACME client to call the management hub API. Generally you should use individual API keys specific to each consumer instead of sharing them across machines, that way when a service is retired you can also remove it's access and you can maintain a clear idea of which things still need access."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"define-a-managed-challenge-configuration",children:"Define a Managed Challenge configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Under ",(0,s.jsx)(n.em,{children:"Services > Managed Challenges"}),", select ",(0,s.jsx)(n.code,{children:"+ Add"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Select dns-01 as the challenge type"}),"\n",(0,s.jsx)(n.li,{children:"Select the DNS provider specific to your domains DNS service."}),"\n",(0,s.jsx)(n.li,{children:"Add or select existing stored credentials for updating DNS via the selected API."}),"\n",(0,s.jsxs)(n.li,{children:["Populate the ",(0,s.jsx)(n.em,{children:"Domain Match Rule"})," to specify the domains this configuration can update DNS for, then Save."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configure-api-access",children:"Configure API Access"}),"\n",(0,s.jsxs)(n.p,{children:["Before you can use your managed challenge you need to configure API access. This involves assigning an API token for a specific ",(0,s.jsx)(n.em,{children:"Service Principle"})," (a specific user or app)."]}),"\n",(0,s.jsxs)(n.p,{children:["Under ",(0,s.jsx)(n.em,{children:"Settings > Security > Users"}),", add a User to represent the consumer (user or app etc) accessing the service, then assign them the Managed Challenge Consumer Role. They can have any other roles they need, but you'll need this specific role to access managed challenges."]}),"\n",(0,s.jsxs)(n.p,{children:["Under ",(0,s.jsx)(n.em,{children:"Settings > Security > API Access"}),", select Add API Token, select the required security principle, enter a descriptive title etc for this consumer token so you know why it exists and what it's being used for. To scope the API access token to managed challenges only, select Managed Challenge Consumer from the Role list and click Add/Remove Role Scope, then Save. A new API token will be created and you will need the Client ID and Secret values to access the API and use the managed challenge."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["In the hub, navigate to ",(0,s.jsx)(n.strong,{children:"Settings > Security > Users"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Add User"})]}),"\n",(0,s.jsxs)(n.li,{children:["Configure as follows:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type"}),": Application/Service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Title"}),': "Managed Challenge User" (for example, to help identify the consumer of the managed challenge)']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Description"}),': "Managed challenge consumer" (for example)']}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["After adding, click the ",(0,s.jsx)(n.strong,{children:"Roles icon"})," (People+ icon) next to the new security principle's ID"]}),"\n",(0,s.jsxs)(n.li,{children:["Select the ",(0,s.jsx)(n.code,{children:"Managed Challenge Consumer"})," role from Available Roles to assign it."]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Save"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-create-an-api-key-to-use-the-managed-challenge",children:"2. Create an API Key to use the managed challenge"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Navigate to ",(0,s.jsx)(n.strong,{children:"Settings > Security > API Access"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Add API Token"})]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"Managed Challenge User"})," as the security principle."]}),"\n",(0,s.jsxs)(n.li,{children:["Enter ",(0,s.jsx)(n.strong,{children:"Managed Challenge API Key"})," as the title"]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"Managed Challenge Consumer"})," as the scoped role","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," Click ",(0,s.jsx)(n.strong,{children:"Add/Remove Role Scope"})," to add it to the scope list"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.strong,{children:"Add"})," to create the new API token"]}),"\n",(0,s.jsxs)(n.li,{children:["Copy the ",(0,s.jsx)(n.strong,{children:"Client ID"})," and ",(0,s.jsx)(n.strong,{children:"Secret"})," values - you'll need these for instance configuration"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"combined-hub-joining-and-managed-challenge-key",children:"Combined Hub joining and Managed Challenge Key"}),"\n",(0,s.jsx)(n.p,{children:"It is possible to create a combined hub joining key and managed challenge key, which certain clients (such as Certify Certificate Manager) can use by default if they already know the hub joining key. This is provided as an option for convenience but is not configured by default."}),"\n",(0,s.jsxs)(n.p,{children:["To enable this, add the Managed Challenge Consumer role to the managed instance service principle (or a new service principle), then create a new hub joining key with both the ",(0,s.jsx)(n.em,{children:"Hub Managed Instance"})," role and ",(0,s.jsx)(n.em,{children:"Managed Challenge Consumer"})," role scope."]}),"\n",(0,s.jsx)(n.h3,{id:"configure-your-acme-client",children:"Configure your ACME Client"}),"\n",(0,s.jsx)(n.p,{children:"Where an ACME client supports Certify Managed Challenges you will follow the normal process used by that client for selecting that provider and you will be required to specify the Client ID and Secret from the above configuration, you will also need to specify the Management Hub API Url. When you then perform your certificate order it will call the Management Hub API to complete the DNS updates required."}),"\n",(0,s.jsx)(n.p,{children:"In Certify Certificate Manager, under Authorization, select dns-01 as the Challenge Type, and Certify Managed Challenge API as the provider, then add the required credentials."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var t=i(96540);const s={},a=t.createContext(s);function l(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);