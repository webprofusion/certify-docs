"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5172],{46698:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"hub/guides/agent","title":"Certify Management Agent (Linux, macOS)","description":"Summary","source":"@site/docs/hub/guides/agent.md","sourceDirName":"hub/guides","slug":"/hub/guides/agent","permalink":"/docs/hub/guides/agent","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/hub/guides/agent.md","tags":[],"version":"current","frontMatter":{"title":"Certify Management Agent (Linux, macOS)"},"sidebar":"hubDocSidebar","previous":{"title":"Certify Certificate Manager (Desktop)","permalink":"/docs/hub/guides/ccm"},"next":{"title":"Certificates","permalink":"/docs/guides/certificates"}}');var s=t(74848),r=t(28453);const a={title:"Certify Management Agent (Linux, macOS)"},c=void 0,o={},l=[{value:"Summary",id:"summary",level:2},{value:"Installation and Upgrades",id:"installation-and-upgrades",level:2},{value:"Joining the Management Hub",id:"joining-the-management-hub",level:2},{value:"Before Joining the Hub",id:"before-joining-the-hub",level:2},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Joining the Hub",id:"joining-the-hub",level:2},{value:"Verification",id:"verification",level:2},{value:"Using the Hub to manage the agent",id:"using-the-hub-to-manage-the-agent",level:2},{value:"Monitoring External Certificate Managers",id:"monitoring-external-certificate-managers",level:3},{value:"Service Administration",id:"service-administration",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.em,{children:"Certify Management Agent"})," is a service which can be use on Linux or macOS to perform certificate renewals and deployment tasks, or to monitor renewals managed by external certificate managers (including Certbot, acme.sh, win-acme/simple-acme and Posh-ACME). The agent is functionally the same as ",(0,s.jsx)(n.a,{href:"/docs/hub/guides/ccm",children:"Certify Certificate Manager"})," on Windows, but without a Desktop UI."]}),"\n",(0,s.jsx)(n.h2,{id:"installation-and-upgrades",children:"Installation and Upgrades"}),"\n",(0,s.jsxs)(n.p,{children:["See our ",(0,s.jsx)(n.a,{href:"../installation/linux#certify-management-agent",children:"install guide"})," for details installing and upgrading."]}),"\n",(0,s.jsx)(n.h2,{id:"joining-the-management-hub",children:"Joining the Management Hub"}),"\n",(0,s.jsxs)(n.p,{children:["Joining your existing ",(0,s.jsx)(n.em,{children:"Certify Management Agent"})," instance to a Management Hub allows you to control the instance settings, renewals and monitoring."]}),"\n",(0,s.jsx)(n.p,{children:"The basic steps are:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Set up a Joining API key in the hub (one is automatically created when the hub is installed)."}),"\n",(0,s.jsx)(n.li,{children:"Configure the agent to join the hub (via the command line)"}),"\n",(0,s.jsx)(n.li,{children:"Verify that the joining has completed in the hub UI"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"before-joining-the-hub",children:"Before Joining the Hub"}),"\n",(0,s.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsxs)(n.admonition,{title:"Important",type:"warning",children:[(0,s.jsx)(n.p,{children:"The Management Hub will have complete control over the Certify Management Agent instance settings, including the ability to specify deployment tasks which may include locally executed code (PowerShell etc)."}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Do not join a hub you don't control or trust."})})]}),"\n",(0,s.jsx)(n.h2,{id:"joining-the-hub",children:"Joining the Hub"}),"\n",(0,s.jsxs)(n.p,{children:["By default a joining API key is created when you install the hub. This is found under ",(0,s.jsx)(n.em,{children:"Settings > Security > API Access"}),". You will need the API URL (e.g. ",(0,s.jsx)(n.code,{children:"https://hub.internal.yourdomain.com:9697"})," depending on your configuration), Client Id and Client Secret values."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'curl -X POST http://127.0.0.2:9696/api/system/hub/join -H \'Content-Type: application/json\' -d \'{"clientId":"managedinstance_sp_01","secret":"<secret>","url":"<hub url>"}\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,s.jsxs)(n.p,{children:["After joining, confirm that your instance appears in the Management Hub UI's ",(0,s.jsx)(n.strong,{children:"Instances"})," list."]}),"\n",(0,s.jsx)(n.h2,{id:"using-the-hub-to-manage-the-agent",children:"Using the Hub to manage the agent"}),"\n",(0,s.jsx)(n.p,{children:"When you are working with individual settings such as Stored Credentials, Certificate Authority accounts etc these remain per-instance settings, so each instance of the app has it's own set of settings and you will selected the target\ninstance when working with those."}),"\n",(0,s.jsx)(n.h3,{id:"monitoring-external-certificate-managers",children:"Monitoring External Certificate Managers"}),"\n",(0,s.jsx)(n.p,{children:"The agent can provide monitoring of renewals that are managed by a selected number of ACME certificate management tools including Certbot, acme.sh, win-acme/simple-acme and Posh-ACME."}),"\n",(0,s.jsxs)(n.p,{children:["With your agent installed on your target machine and joined to the hub, configure the paths for your chosen certificate manager under ",(0,s.jsx)(n.em,{children:"Settings > General > External Certificate Managers"}),", ensuring to select your target instance from the Target Instance dropdown list at the top the page. By default the system will attempt to discover existing config using the default paths. Configuration of log paths is only required where logs are stored separately from the other config (e.g. Certbot)."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Cert Manager"}),(0,s.jsx)(n.th,{children:"Default Config Path"}),(0,s.jsx)(n.th,{children:"Default Log Path"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"acme.sh"}),(0,s.jsx)(n.td,{children:"~/.acme.sh/"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"certbot"}),(0,s.jsx)(n.td,{children:"/etc/letsencrypt"}),(0,s.jsx)(n.td,{children:"/var/log/letsencrypt"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"posh-acme"}),(0,s.jsx)(n.td,{children:"%APPDATA%\\Local\\Posh-ACME"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"simple-acme"}),(0,s.jsx)(n.td,{children:"%PROGRAMDATA%\\simple-acme"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"win-acme"}),(0,s.jsx)(n.td,{children:"%PROGRAMDATA%\\simple-acme"}),(0,s.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["The user account the agent service runs as ",(0,s.jsx)(n.strong,{children:"will need permission to read"})," from whichever paths are required in your installation, otherwise it will fail to discover the certificate configurations etc."]}),"\n",(0,s.jsx)(n.p,{children:"The agent will cache results from each certificate manager and periodically refresh results, so changes to renewals etc will take a few minutes to show up in the hub UI."}),"\n",(0,s.jsx)(n.h2,{id:"service-administration",children:"Service Administration"}),"\n",(0,s.jsx)(n.p,{children:"When the service is installed using systemd the following commands can be useful:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Task"}),(0,s.jsx)(n.th,{children:"Command"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Restart the Service"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sudo systemctl restart certify-agent"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Check systemd log"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"journalctl -u certify-agent"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Follow current log"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"journalctl -u certify-agent -f"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:"If the agent is listed in the hub, but viewing managed certificates etc fails there may be a mismatch between the instanceID assigned by the hub and the settings currently stored in the agent config."}),"\n",(0,s.jsx)(n.p,{children:"To resolve this:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Remove the instance from the hub (Managed Instances > Remove)"}),"\n",(0,s.jsxs)(n.li,{children:["Edit the agents config at ",(0,s.jsx)(n.code,{children:"/usr/shre/certify/serviceconfig.json"})," and remove the ",(0,s.jsx)(n.code,{children:'"HubAssignedInstanceId": "<GUID>",'})," line, then restart the certify-agent service."]}),"\n",(0,s.jsx)(n.li,{children:"Re-join the agent to the hub"}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);