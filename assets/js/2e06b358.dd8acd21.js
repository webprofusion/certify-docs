"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8124],{45182:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>n,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"deployment/tasks_intro","title":"Deployment Tasks","description":"Deployment Tasks are a powerful new feature introduced in *Certify Certificate Manager* v5.x and above.","source":"@site/docs/deployment/tasks_intro.md","sourceDirName":"deployment","slug":"/deployment/tasks_intro","permalink":"/docs/deployment/tasks_intro","draft":false,"unlisted":false,"editUrl":"https://github.com/webprofusion/certify-docs/edit/master/docs/deployment/tasks_intro.md","tags":[],"version":"current","frontMatter":{"id":"tasks_intro","title":"Deployment Tasks"},"sidebar":"commonDocsSidebar","previous":{"title":"DNS Domain Validation (dns-01)","permalink":"/docs/dns/validation"},"next":{"title":"Scripting","permalink":"/docs/script-hooks"}}');var i=s(74848),o=s(28453);const n={id:"tasks_intro",title:"Deployment Tasks"},a=void 0,c={},l=[{value:"Pre-Request Tasks",id:"pre-request-tasks",level:2},{value:"Deployment Tasks",id:"deployment-tasks",level:2},{value:"Task Triggers",id:"task-triggers",level:3},{value:"Built-in Task Types",id:"built-in-task-types",level:3},{value:"Run a Powershell script",id:"run-a-powershell-script",level:3},{value:"Passing custom arguments",id:"passing-custom-arguments",level:4},{value:"Call a custom Webhook",id:"call-a-custom-webhook",level:3},{value:"Deploy to Apache, nginx, Generic Server, Certificate Export",id:"deploy-to-apache-nginx-generic-server-certificate-export",level:3},{value:"Deploy to Certificate Store (Local)",id:"deploy-to-certificate-store-local",level:3},{value:"Strategies for Remote Deployment",id:"strategies-for-remote-deployment",level:2},{value:"Linux",id:"linux",level:3},{value:"Windows",id:"windows",level:3},{value:"PowerShell with network use impersonation",id:"powershell-with-network-use-impersonation",level:4},{value:"Export to Remote share, use a Windows Scheduled Task for deployment",id:"export-to-remote-share-use-a-windows-scheduled-task-for-deployment",level:4}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:[(0,i.jsxs)(t.strong,{children:["Deployment Tasks are a powerful new feature introduced in ",(0,i.jsx)(t.em,{children:"Certify Certificate Manager"})," v5.x and above."]}),"\nOnce you have a certificate issued by a certificate authority you can go ahead and use that certificate for it's intended purpose. This is generally anything that might require a valid verified domain (such as a webserver, mail server, ftp service, remote access etc)."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Startup UI",src:s(85366).A+"",width:"688",height:"445"})}),"\n",(0,i.jsx)(t.p,{children:"By default the app supports Auto deployment to the local machine certificate store and will auto configure/update https bindings in IIS on the local server."}),"\n",(0,i.jsxs)(t.p,{children:["If you need to perform more custom steps using the certificate, or if you just want to perform certain workflows after the certificate has been renewed (such as a restarting a local or remote service), you can use ",(0,i.jsx)(t.em,{children:"Deployment Tasks"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"pre-request-tasks",children:"Pre-Request Tasks"}),"\n",(0,i.jsx)(t.p,{children:"You may wish to run a custom task before you renew your certificate. For instance, you may wish to to make automated firewall changes or call a custom Web Hook/API. These are called 'Pre-Request Tasks'."}),"\n",(0,i.jsx)(t.h2,{id:"deployment-tasks",children:"Deployment Tasks"}),"\n",(0,i.jsx)(t.p,{children:"You may want to run any number of tasks after you have renewed your certificate or after it has been automatically deployed. For instance, running scripts, exporting for different server types (Apache, nginx), copying to remote servers etc. These are called 'Deployment Tasks' or Post-Request Tasks."}),"\n",(0,i.jsx)(t.h3,{id:"task-triggers",children:"Task Triggers"}),"\n",(0,i.jsx)(t.p,{children:"You can configure a task to run either when a certificate request was successful or on error, or you can opt to run the task manually."}),"\n",(0,i.jsx)(t.p,{children:"Manually running a task is useful when you want to avoid restarting a service outside of maintenance hours, or if you wish to run the tasks from the command line, a script or a scheduled task. Example command line arguments are shown in the UI to help with scripting."}),"\n",(0,i.jsx)(t.h3,{id:"built-in-task-types",children:"Built-in Task Types"}),"\n",(0,i.jsx)(t.p,{children:"Built-in deployment task types, each with UI to configure the task parameters etc, include:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy Certificate to ADFS"}),(0,i.jsx)(t.td,{children:"Applies the certificate a local Active Directory Federation Services installation"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/docs/deployment/tasks/apache",children:"Deploy to Apache"})}),(0,i.jsx)(t.td,{children:"Export the certificate components in PEM file format for use with the Apache webserver."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/docs/deployment/tasks/tomcat",children:"Deploy to Apache Tomcat"})}),(0,i.jsx)(t.td,{children:"Export the certificate as a pkcs12 key store for use with Apache Tomcat application server."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/docs/deployment/tasks/task-azure-app-service",children:"Deploy to Azure App Service"})}),(0,i.jsx)(t.td,{children:"Note that setting a PFX password (Certificate> Advanced > Signing & Security) is required for this deployment."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy to Azure Key Vault"}),(0,i.jsx)(t.td,{children:"Export the certificate to your choice of Azure Key Vault for use with other Azure services or sharing with other systems. Supports service variations such as Azure Cloud, Azure US Government, Azure China etc."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/docs/deployment/tasks/ccs",children:"Deploy to Centralized Certificate Store (CCS)"})}),(0,i.jsx)(t.td,{children:"Copies to a chosen UNC share using the credentials you provide, automatically naming the files as required by IIS for each domain. You then configure the IIS CCS feature to pick up certs from the share."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy to Doppler"}),(0,i.jsx)(t.td,{children:"Deploys the chosen certificate components to the Doppler secrets storage service."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/docs/deployment/tasks/exchange",children:"Deploy to Microsoft Exchange"})}),(0,i.jsx)(t.td,{children:"Export the certificate to a local MS Exchange services and apply it to an optional list of services (IMAP, SMTP, IIS, POP etc)."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy to Hashicorp Vault"}),(0,i.jsx)(t.td,{children:"Export the certificate to your Vault instance, with optional namespaces."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"/docs/deployment/tasks/nginx",children:"Deploy to nginx"})}),(0,i.jsx)(t.td,{children:"Export the certificate components in PEM file format for use with the nginx webserver."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy to RAS (Direct Access, VNP, SSTP VPN etc)"}),(0,i.jsx)(t.td,{children:"Provides a basic deployment for RAS. You may require your own script for more sophisticated deployments."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy to RDP Gateway Service"}),(0,i.jsx)(t.td,{children:"Provides a basic deployment for a local RDP Gateway. You may require your own script for more sophisticated deployments."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Deploy to RDP Listener Service"}),(0,i.jsx)(t.td,{children:"Provides a basic deployment for a local RDP Listener (Terminal Services)."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Run a Script"}),(0,i.jsx)(t.td,{children:"Execute an environment specific script (such as as a windows batch file or a linux bash script)."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Stop, Start or Restart a Service"}),(0,i.jsx)(t.td,{children:"Select a local service to restart. Usually used in conjunction with another deployment task to cause the new certificate to new applied."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Set Certificate Key Permissions"}),(0,i.jsx)(t.td,{children:"Although not usually required, some services may need read permission granted for the certificate private key. This task adds read permission for the nominated account."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Update Port Binding"}),(0,i.jsxs)(t.td,{children:["Provides a standard way to perform netsh IP",":port"," bindings without custom scripting."]})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"run-a-powershell-script",children:"Run a Powershell script"}),"\n",(0,i.jsxs)(t.p,{children:["Execute a custom ",(0,i.jsx)(t.a,{href:"/docs/script-hooks",children:"PowerShell script"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Some example scripts (e.g. for ",(0,i.jsx)(t.code,{children:"Web Management Service"}),") are provided under ",(0,i.jsx)(t.code,{children:"C:\\Program Files\\CertifyTheWeb\\Scripts\\Common"}),". If you use any of these you should copy the script to your own choice of folder outside of Program Files as any app updates will overwrite the files in this Program Files location and any edits you make will be lost."]}),"\n",(0,i.jsx)(t.h4,{id:"passing-custom-arguments",children:"Passing custom arguments"}),"\n",(0,i.jsxs)(t.p,{children:["Note if passing additional arguments to your script these should be in the format arg=value;arg2=value and ",(0,i.jsx)(t.code,{children:";"})," characters required as parameter values need to be escaped with ",(0,i.jsx)(t.code,{children:"\\"}),", like ",(0,i.jsx)(t.code,{children:"key=abc\\;123h;othervalue=test"}),". The ",(0,i.jsx)(t.code,{children:"\\"})," character can be escaped as ",(0,i.jsx)(t.code,{children:"\\\\"})," e.g. to pass an couple of arguments and the first is ",(0,i.jsx)(t.code,{children:"path"})," with value ",(0,i.jsx)(t.code,{children:"c:\\temp\\folder"})," you could use ",(0,i.jsx)(t.code,{children:"path=c:\\temp\\folder\\\\;other=test"})]}),"\n",(0,i.jsx)(t.h3,{id:"call-a-custom-webhook",children:"Call a custom Webhook"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.em,{children:"Webhook"})," task can call a webhook with details of the latest certificate request status. Your custom Body template can use variables, e.g.:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'{\n  "Success": "$Success",\n  "PrimaryDomain": "$PrimaryDomain",\n  "SANs": "$SubjectAlternativeNames"\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["For advanced webhook scenarios, a custom script is recommended (see ",(0,i.jsx)(t.em,{children:"Run a Powershell Script"})," above)."]}),"\n",(0,i.jsx)(t.h3,{id:"deploy-to-apache-nginx-generic-server-certificate-export",children:"Deploy to Apache, nginx, Generic Server, Certificate Export"}),"\n",(0,i.jsx)(t.p,{children:"Export the certificate to local or remote locations (including SSH/SFTP) as PEM format with Key file and optional chain file."}),"\n",(0,i.jsxs)(t.p,{children:["For a general introduction to certificates and their file types see ",(0,i.jsx)(t.a,{href:"/docs/guides/certificates",children:"Certificates"}),"."]}),"\n",(0,i.jsx)(t.admonition,{title:"SSH Private Keys",type:"note",children:(0,i.jsxs)(t.p,{children:["We currently use the ssh.net library for .net to provide our SSH related features within Tasks. If using an ssh private key file for authentication please ensure the file is in PEM (text) format. Multiple key types are supported but only aes256-cbc key encryption is ",(0,i.jsx)(t.a,{href:"https://github.com/sshnet/SSH.NET/issues/742#issuecomment-1292945883",children:"supported by ssh.net"}),"."]})}),"\n",(0,i.jsx)(t.h3,{id:"deploy-to-certificate-store-local",children:"Deploy to Certificate Store (Local)"}),"\n",(0,i.jsx)(t.p,{children:"This task is deprecated and is not generally required. This imports the certificate into the local certificate store with your choice of store type (Personal, Web Hosting) and choice of Friendly Name. Note that the default auto deployment system in Certify will already store certificates in the My/Personal certificate store."}),"\n",(0,i.jsx)(t.h2,{id:"strategies-for-remote-deployment",children:"Strategies for Remote Deployment"}),"\n",(0,i.jsx)(t.p,{children:"The easiest way to renew a certificate on a server is usually to install Certify Certificate Manager and run it locally, however sometimes a remote deployment is desirable depending on what you want to achieve:"}),"\n",(0,i.jsx)(t.h3,{id:"linux",children:"Linux"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Use a ",(0,i.jsx)(t.em,{children:"Deploy to Generic Server"})," task (or other more specific tasks) to export the files you need via SSH/SFTP."]}),"\n",(0,i.jsx)(t.li,{children:"Then use the Script task to then run the commands you need to reload services etc."}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"windows",children:"Windows"}),"\n",(0,i.jsx)(t.h4,{id:"powershell-with-network-use-impersonation",children:"PowerShell with network use impersonation"}),"\n",(0,i.jsx)(t.p,{children:"Some PowerShell scripts can work remotely via impersonation using credentials that have the necessary permissions, with logon type set to Network (For instance). However not all scripts succeed in adequate levels of impersonation, depending on how the script works and whether it launches new processes etc."}),"\n",(0,i.jsx)(t.h4,{id:"export-to-remote-share-use-a-windows-scheduled-task-for-deployment",children:"Export to Remote share, use a Windows Scheduled Task for deployment"}),"\n",(0,i.jsx)(t.p,{children:"Where necessary you can instead export the PFX file to where you need it, then use a script to pick up the file, use it, then delete it once deployment has completed."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["In the app, Add an ",(0,i.jsx)(t.em,{children:"Export Certificate"})," task to copy the PFX to a temporary location e.g. a UNC share on the target server."]}),"\n",(0,i.jsxs)(t.li,{children:["Create a script to look for the PFX file and if present run your scripted deployment steps using that file, it should then delete the temporary PFX file so that the next run will skip the deployment steps.","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"If an error occurs during your deployment step, report that using a log or notification script."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["On your target server, schedule your Windows Task to run your script regularly (e.g. hourly or daily, or within a maintenance schedule) as the required user.","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"As you are looking for the file in your script before doing anything it will only ever run the deployment when the certificate file exists (e.g. it has recently been exported by the renewal process)."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},85366:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/images/DeploymentTasks-2593f0b566501d7bd3da996402cc4e79.png"},28453:(e,t,s)=>{s.d(t,{R:()=>n,x:()=>a});var r=s(96540);const i={},o=r.createContext(i);function n(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:n(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);