<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-script-hooks" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Scripting | Certify The Web Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.certifytheweb.com/docs/script-hooks"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Scripting | Certify The Web Docs"><meta data-rh="true" name="description" content="Certify is extensible via PowerShell custom scripts tasks which can be configured to run before or after the Certificate Request. The app also has a number of built-in tasks for common scenarios, see Tasks for more information."><meta data-rh="true" property="og:description" content="Certify is extensible via PowerShell custom scripts tasks which can be configured to run before or after the Certificate Request. The app also has a number of built-in tasks for common scenarios, see Tasks for more information."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.certifytheweb.com/docs/script-hooks"><link data-rh="true" rel="alternate" href="https://docs.certifytheweb.com/docs/script-hooks" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.certifytheweb.com/docs/script-hooks" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://YX7T7PF7BX-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Scripting","item":"https://docs.certifytheweb.com/docs/script-hooks"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Certify The Web Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Certify The Web Docs Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RLGYG5TYY5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RLGYG5TYY5",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Certify The Web Docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.59a313f4.css">
<script src="/assets/js/runtime~main.92b6423b.js" defer="defer"></script>
<script src="/assets/js/main.f081303f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Certify The Web - Docs</b></a><a class="navbar__item navbar__link" href="/docs/intro">Certificate Manager</a><a class="navbar__item navbar__link" href="/docs/hub/">Management Hub</a><a class="navbar__item navbar__link" href="/docs/dashboard/">Dashboard</a><a class="navbar__item navbar__link" href="/docs/dns/providers/certifydns/">Certify DNS</a><a class="navbar__item navbar__link" href="/docs/features">Features</a><a class="navbar__item navbar__link" href="/docs/support">Support</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://certifytheweb.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">certifytheweb.com<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--active"><span title="Supporting Information" class="categoryLinkLabel_W154">Supporting Information</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--active" tabindex="0"><span title="Guides" class="categoryLinkLabel_W154">Guides</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/features/"><span title="Background Information" class="categoryLinkLabel_W154">Background Information</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/deployment/tasks_intro"><span title="Advanced Deployment" class="categoryLinkLabel_W154">Advanced Deployment</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/tasks_intro"><span title="Deployment Tasks" class="linkLabel_WmDU">Deployment Tasks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/script-hooks"><span title="Scripting" class="linkLabel_WmDU">Scripting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/apache-nginx"><span title="Apache, nginx etc" class="linkLabel_WmDU">Apache, nginx etc</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/import-export"><span title="Import &amp; Export" class="linkLabel_WmDU">Import &amp; Export</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/features/data-stores"><span title="Data Stores" class="linkLabel_WmDU">Data Stores</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/features/certificate-advanced"><span title="Other Advanced Options" class="categoryLinkLabel_W154">Other Advanced Options</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link" tabindex="0"><span title="Support" class="categoryLinkLabel_W154">Support</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq"><span title="Frequently Asked Questions" class="linkLabel_WmDU">Frequently Asked Questions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/support"><span title="Support Options" class="linkLabel_WmDU">Support Options</span></a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Supporting Information</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced Deployment</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Scripting</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scripting</h1></header>
<p>Certify is extensible via PowerShell custom scripts tasks which can be configured to run before or after the Certificate Request. The app also has a number of built-in tasks for common scenarios, see <a href="/docs/deployment/tasks_intro">Tasks</a> for more information.</p>
<p>To run a custom PowerShell script when your certificate renews, you can add the <em>Run a PowerShell Script</em> deployment task to your managed certificate. You can also add a script to run before the certificate request is made, to perform any pre-request checks or configuration.</p>
<p>The scripts are always provided a <code>$result</code> argument which contains the status and details of the managed certificate being requested. You can execute any commands including creating new processes, or using other command line tools.</p>
<p>A common use for scripting is to use your new certificate for services other than IIS websites, such as Microsoft Exchange, RDP Gateway, FTP servers and other services.</p>
<p><em>By default the background service runs as Local System, so your scripts will execute in that context</em>, this can be important for issues regarding permissions, file system encryption etc. You can optionally configure your task to run as a specific user if network access or special permissions are required.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Do not store scripts under the C:\Program Files\CertifyTheWeb\ path. File stored there will be deleted next time you update the app.</p></div></div>
<p>All scripts should be refined and tested in a staging environment before use in production.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>See More Example Scripts</div><div class="admonitionContent_BuS1"><p>Example and community-contributed scripts can also be found at <a href="https://github.com/webprofusion/certify-script-examples" target="_blank" rel="noopener noreferrer">https://github.com/webprofusion/certify-script-examples</a> - feel free to contribute your own examples to share with others.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scripting-basics">Scripting Basics<a href="#scripting-basics" class="hash-link" aria-label="Direct link to Scripting Basics" title="Direct link to Scripting Basics" translate="no">​</a></h2>
<p>Here is a sample PowerShell script which demonstrates a few commonly accessed pieces of information:</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># required to access the $result parameter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># either $true or $false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">IsSuccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># object containing all information Certify has about the saved Site</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the IIS (or other service) site ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ServerSiteId   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ex: 1, 2, 3, ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the website root directory (if applicable)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">WebsiteRootPath   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ex: &quot;C:\inetpub\wwwroot&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the path to the created/renewed certificate PFX file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificatePath   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ex: &quot;C:\ProgramData\Certify\certes\assets\pfx\00f9e07e-83ca-4029-a173-4b704ee78996.pfx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the certificate thumbprint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ex: &quot;78b1080a1bf5e7fc0bbb0c0614fc4a18932db5f9&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the previous certificate thumbprint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificatePreviousThumbprintHash  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ex: &quot;18c1060a1be5e6fc0bbb0c0614fc4a18932db5fa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># You can set $result.Abort to $true in a pre-request hook to prevent the certificate from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># being requested (has no effect in post-request hooks)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Abort = </span><span class="token boolean" style="color:rgb(255, 88, 116)">$false</span><br></span></code></pre></div></div>
<p>The <code>$result.ManagedItem</code> object is an instance of the <a href="https://github.com/webprofusion/certify/blob/development/src/Certify.Models/Config/ManagedCertificate.cs" target="_blank">ManagedCertificate</a> class, so all of the properties it has will be available in your script:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-request-tasks">Pre-Request Tasks<a href="#pre-request-tasks" class="hash-link" aria-label="Direct link to Pre-Request Tasks" title="Direct link to Pre-Request Tasks" translate="no">​</a></h2>
<p>Notes: Pre-request scripts/tasks are executed immediately before the Certificate Request is about to be made (including the challenge file configuration checks).</p>
<ul>
<li>The <code>$result.IsSuccess</code> value will always be <code>$false</code>.</li>
<li>If for some reason your script would like to prevent the Certificate Request from being executed, you may set <code>$result.Abort</code> to <code>$true</code> and the site your script was executed for will be skipped.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-tasks-post-request">Deployment Tasks (Post-Request)<a href="#deployment-tasks-post-request" class="hash-link" aria-label="Direct link to Deployment Tasks (Post-Request)" title="Direct link to Deployment Tasks (Post-Request)" translate="no">​</a></h2>
<p>Deployment task (post-request) scripts are executed immediately after the Certificate Request was completed, and the certificate was automatically installed and configured according to the site configuration within Certify.</p>
<p>By default these run if the request was successful but you can change the task trigger (On Success, On Fail, etc). You can also configure them for manual execution only, so that you can perform them during a maintenance window, or via a windows scheduled task using the command line.</p>
<ul>
<li>The <code>$result.IsSuccess</code> value indicates whether or not the Certificate Request was successfully completed.</li>
<li>The <code>$result.Message</code> value provides a message describing the reason for failure, or a message indicating success.</li>
</ul>
<p>Legacy uses for scripting (v4.x and lower) may have previously included CCS Export, PEM file creation etc however these functions are provided by built-in Deployment Tasks which you should use instead unless the built-in functionality does not meet your requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-output-the-result-properties-to-a-text-file">Example: Output the result properties to a text file<a href="#example-output-the-result-properties-to-a-text-file" class="hash-link" aria-label="Direct link to Example: Output the result properties to a text file" title="Direct link to Example: Output the result properties to a text file" translate="no">​</a></h3>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Logs results to the given path (modify as required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$logpath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c:\temp\ps-test.txt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$date</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">Get-Date</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Add-Content</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$logpath</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-------------------------------------------------&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Add-Content</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$logpath</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Script Run Date: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Add-Content</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$logpath</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ConvertTo-Json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-send-email-via-gmail-after-unsuccessful-renewal">Example: Send email via Gmail after unsuccessful renewal<a href="#example-send-email-via-gmail-after-unsuccessful-renewal" class="hash-link" aria-label="Direct link to Example: Send email via Gmail after unsuccessful renewal" title="Direct link to Example: Send email via Gmail after unsuccessful renewal" translate="no">​</a></h3>
<p><em>Note: this is an example only, by default the app will use the certifytheweb.com API to notify you of repeated failures.</em></p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">IsSuccess</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$EmailFrom</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;username@gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$EmailTo</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;username@gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$Subject</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Cert Request Failed: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RequestConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PrimaryDomain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$Body</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Error: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$SMTPServer</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;smtp.gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$SMTPClient</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">New-Object</span><span class="token plain"> Net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Mail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SmtpClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$SmtpServer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 587</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$SMTPClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">EnableSsl = </span><span class="token boolean" style="color:rgb(255, 88, 116)">$true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$SMTPClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Credentials = </span><span class="token function" style="color:rgb(130, 170, 255)">New-Object</span><span class="token plain"> System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">NetworkCredential</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;username@gmail.com&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$SMTPClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$EmailFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$EmailTo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$Subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$Body</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">write-output</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Sent notification email&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-restart-rras-after-successful-certificate-renewal">Example: Restart RRAS after successful certificate renewal<a href="#example-restart-rras-after-successful-certificate-renewal" class="hash-link" aria-label="Direct link to Example: Restart RRAS after successful certificate renewal" title="Direct link to Example: Restart RRAS after successful certificate renewal" translate="no">​</a></h3>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">IsSuccess </span><span class="token operator" style="color:rgb(137, 221, 255)">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GroupId </span><span class="token operator" style="color:rgb(137, 221, 255)">-eq</span><span class="token plain"> 1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">write-output</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Restarting RRAS...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Stop RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Net </span><span class="token function" style="color:rgb(130, 170, 255)">Start</span><span class="token plain"> RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">write-output</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Done&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-convert-cng-certificate-storage-to-csp-for-exchange-2013">Example: Convert CNG certificate storage to CSP (for Exchange 2013)<a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" class="hash-link" aria-label="Direct link to Example: Convert CNG certificate storage to CSP (for Exchange 2013)" title="Direct link to Example: Convert CNG certificate storage to CSP (for Exchange 2013)" translate="no">​</a></h3>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$tempfile</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$env</span><span class="token string" style="color:rgb(195, 232, 141)">:TEMP\CertifyTemp.pfx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$pfx</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">get-pfxcertificate</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">filepath </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificatePath</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certutil </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">f </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">p Certify </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">exportpfx </span><span class="token variable" style="color:rgb(191, 199, 213)">$pfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SerialNumber </span><span class="token variable" style="color:rgb(191, 199, 213)">$tempfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certutil </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">delstore my </span><span class="token variable" style="color:rgb(191, 199, 213)">$pfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SerialNumber</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certutil </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">p Certify </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">csp </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Microsoft RSA SChannel Cryptographic Provider&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">importpfx </span><span class="token variable" style="color:rgb(191, 199, 213)">$tempfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">remove-item</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$tempfile</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-enable-certificate-for-exchange-2013--2016-services-on-local-server">Example: Enable certificate for Exchange 2013 / 2016 services on local server<a href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" class="hash-link" aria-label="Direct link to Example: Enable certificate for Exchange 2013 / 2016 services on local server" title="Direct link to Example: Enable certificate for Exchange 2013 / 2016 services on local server" translate="no">​</a></h3>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Enable-ExchangeCertificate</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Thumbprint </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Services POP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">IMAP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">SMTP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">IIS </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Force</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-vmware-horizon-certificate">Example: Update VMWare Horizon certificate<a href="#example-update-vmware-horizon-certificate" class="hash-link" aria-label="Direct link to Example: Update VMWare Horizon certificate" title="Direct link to Example: Update VMWare Horizon certificate" translate="no">​</a></h3>
<p>This example removes any previous certificate with the same FriendlyName (<code>vdm</code>) then renames the Friendly Name property of the new certificate to <code>vmd</code>. It then restarts the <code>wstunnel</code> service.</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">IsSuccess</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$thumbprint</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># e.g. 2c127d49b4f63d947dd7b91750c9e57751eced0c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># remove the old cert (by Friendly Name &#x27;vdm&#x27;) to avoid duplication, if it exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path cert:\LocalMachine\My </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> Where </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token variable" style="color:rgb(191, 199, 213)">$_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FriendlyName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Equals</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;vdm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Remove-Item</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># rename our new certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$cert</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path cert:\LocalMachine\My\</span><span class="token variable" style="color:rgb(191, 199, 213)">$thumbprint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$cert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FriendlyName =</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;vdm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># restart the wstunnel service to apply certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">Restart-Service</span><span class="token plain"> wstunnel </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Force </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ErrorAction Stop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-certificate-for-sstp-vpn">Example: Update certificate for SSTP VPN<a href="#example-update-certificate-for-sstp-vpn" class="hash-link" aria-label="Direct link to Example: Update certificate for SSTP VPN" title="Direct link to Example: Update certificate for SSTP VPN" translate="no">​</a></h4>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Store certificate in variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$cert</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path Cert:\LocalMachine\My </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token variable" style="color:rgb(191, 199, 213)">$_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Thumbprint </span><span class="token operator" style="color:rgb(137, 221, 255)">-match</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Stop RRAS, set cert, start RRAS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Import-Module</span><span class="token plain"> RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Stop-Service</span><span class="token plain"> RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Set-RemoteAccess</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SslCertificate </span><span class="token variable" style="color:rgb(191, 199, 213)">$cert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Start-Service</span><span class="token plain"> RemoteAccess</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-sql-server-connection-certificate">Example: Update SQL Server connection certificate<a href="#example-update-sql-server-connection-certificate" class="hash-link" aria-label="Direct link to Example: Update SQL Server connection certificate" title="Direct link to Example: Update SQL Server connection certificate" translate="no">​</a></h3>
<p>This example updates the registry key for the SQL Server certificate thumbprint. Note that the instance name will affect the name of the registry key, so you need to find that and change that in the script. Some SQL Server editions may also require the certificate key to be converted to the older RSA SChannel CSP.</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Example script to set SQL Server certificate </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Note that some instances of SQL server may require certificate key storage to use the &quot;Microsoft RSA SChannel Cryptographic Provider&quot; </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># See an example conversion: https://docs.certifytheweb.com/docs/script-hooks#example-convert-cng-certificate-storage-to-csp-for-exchange-2013</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># See HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\ for the required instance key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$instanceKey</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MSSQL15.MSSQLSERVER&#x27;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Change this as required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># -------------------------------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$registryPath</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\</span><span class="token string variable" style="color:rgb(191, 199, 213)">$instanceKey</span><span class="token string" style="color:rgb(195, 232, 141)">\MSSQLServer\SuperSocketNetLib&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumbprint</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">Get-Itemproperty</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(191, 199, 213)">$registryPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumbprint</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumb</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># apply the new certificate thumbprint to the registry key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">Set-ItemProperty</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(191, 199, 213)">$registryPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Certificate&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Value </span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optionally restart the SQL service (uncomment if required in this step), correct service name may vary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Restart-Service mssqlserver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-sql-server-reporting-services">Example: Update SQL Server Reporting Services<a href="#example-update-sql-server-reporting-services" class="hash-link" aria-label="Direct link to Example: Update SQL Server Reporting Services" title="Direct link to Example: Update SQL Server Reporting Services" translate="no">​</a></h3>
<p>This is adapted from a community example: <a href="https://community.certifytheweb.com/t/sql-server-reporting-services-ssrs/332/7" target="_blank" rel="noopener noreferrer">https://community.certifytheweb.com/t/sql-server-reporting-services-ssrs/332/7</a></p>
<p>This script gets the report server config object the checks if an existing cert is bound it removes that, then creates the new binding.</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsServerName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RS_MSSQLSERVER&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportManagerName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ReportManager&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportWebServiceName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ReportServerWebService&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$httpsPort</span><span class="token plain"> = 443</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$ipAddress</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0.0.0.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Find the ssrsServerName by running:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Get-WmiObject -namespace root\Microsoft\SqlServer\ReportServer -class __Namespace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># take the value of the name field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$version</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">Get-WmiObject</span><span class="token plain"> –namespace root\Microsoft\SqlServer\ReportServer\</span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsServerName</span><span class="token plain">  –</span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> __Namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">Get-WmiObject</span><span class="token plain"> –namespace </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;root\Microsoft\SqlServer\ReportServer\</span><span class="token string variable" style="color:rgb(191, 199, 213)">$ssrsServerName</span><span class="token string" style="color:rgb(195, 232, 141)">\</span><span class="token string variable" style="color:rgb(191, 199, 213)">$version</span><span class="token string" style="color:rgb(195, 232, 141)">\Admin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> MSReportServer_ConfigurationSetting</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># the cert thumbnail of the newest certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumb</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ToLower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># check the cert thumbnail of the currently bound certificate (if any)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumb</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumb</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ListSSLCertificateBindings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">1033</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateHash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Item</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token namespace" style="color:rgb(178, 204, 214)">[array]</span><span class="token plain">::LastIndexOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ListSSLCertificateBindings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">1033</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Application</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportManagerName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumb</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RemoveSSLCertificateBindings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportManagerName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$ipAddress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$httpsport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 1033</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RemoveSSLCertificateBindings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportWebServiceName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$oldthumb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$ipAddress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$httpsport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 1033</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateSSLCertificateBinding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportManagerName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$ipAddress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$httpsport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 1033</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$rsConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CreateSSLCertificateBinding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$ssrsReportWebServiceName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$newthumb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$ipAddress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$httpsport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 1033</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-setting-private-key-read-permission-for-a-specific-account">Example: Setting private key read permission for a specific account<a href="#example-setting-private-key-read-permission-for-a-specific-account" class="hash-link" aria-label="Direct link to Example: Setting private key read permission for a specific account" title="Direct link to Example: Setting private key read permission for a specific account" translate="no">​</a></h3>
<p>Often you will need to allow a specific user account read permission on a certificate private key to allow a service to use the certificate properly:</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">## Update the read permission on the certificate private key to allow NT AUTHORITY\LOCAL_SERVICE (for example) to use the cert (and private key)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Specify the user, the permissions and the permission type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$permission</span><span class="token plain"> = </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;NT AUTHORITY\LOCAL SERVICE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Read&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Allow&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># get the stored certificate </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$cert</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path cert:\LocalMachine\My\</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># configure file system access rule</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$accessRule</span><span class="token plain"> = </span><span class="token function" style="color:rgb(130, 170, 255)">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">TypeName System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Security</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AccessControl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FileSystemAccessRule </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ArgumentList </span><span class="token variable" style="color:rgb(191, 199, 213)">$permission</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Location of the machine related keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$keyPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$env</span><span class="token plain">:ProgramData </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;\Microsoft\Crypto\RSA\MachineKeys\&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$keyName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$cert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PrivateKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CspKeyContainerInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">UniqueKeyContainerName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$keyFullPath</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$keyPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$keyName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Get the current acl of the private key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$acl</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">Get-Item</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$keyFullPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">GetAccessControl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Access&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Add the new ace to the acl of the private key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">$acl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AddAccessRule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$accessRule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Write back the new acl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">Set-Acl</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(191, 199, 213)">$keyFullPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">AclObject </span><span class="token variable" style="color:rgb(191, 199, 213)">$acl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-the-certificate-on-a-local-winrm-https-listener-windows-admin-center-etc">Example: Update the certificate on a local WinRM https listener (Windows Admin Center etc)<a href="#example-update-the-certificate-on-a-local-winrm-https-listener-windows-admin-center-etc" class="hash-link" aria-label="Direct link to Example: Update the certificate on a local WinRM https listener (Windows Admin Center etc)" title="Direct link to Example: Update the certificate on a local WinRM https listener (Windows Admin Center etc)" translate="no">​</a></h3>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># update the local winrm https listener cert, assumes the cert is already installed to local computer certificate store using Certify</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># based on https://serverfault.com/questions/589607/automatically-reconfigure-winrm-https-listener-with-new-certificate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Set-Location</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path WSMan:\localhost\Service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">Set-Item</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">\CertificateThumbprint </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Value </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-convert-pfx-to-java-key-store-using-keytool">Example: Convert PFX to Java Key Store using keytool<a href="#example-convert-pfx-to-java-key-store-using-keytool" class="hash-link" aria-label="Direct link to Example: Convert PFX to Java Key Store using keytool" title="Direct link to Example: Convert PFX to Java Key Store using keytool" translate="no">​</a></h3>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># adapt paths and passwords as required, assumes keytool is in the system path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># this examples uses -noprompt to avoid the process hanging on prompts and also redirects output to a single stream otherwise keytool will output to the powershell error stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># update these parameters as required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$src_password</span><span class="token plain"> =</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$dest_password</span><span class="token plain"> =</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;examplepwd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$dest_jks_file</span><span class="token plain">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;C:\temp\mykeystore.jks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">keytool </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">noprompt </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">importkeystore </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">srckeystore </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificatePath </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">srcstoretype pkcs12 </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">srcstorepass </span><span class="token variable" style="color:rgb(191, 199, 213)">$src_password</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">destkeystore </span><span class="token variable" style="color:rgb(191, 199, 213)">$dest_jks_file</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deststoretype JKS </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deststorepass </span><span class="token variable" style="color:rgb(191, 199, 213)">$dest_password</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">&gt;&amp;1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-deploy-to-web-management-service-web-deploy-etc">Example: Deploy to Web Management Service (Web Deploy etc)<a href="#example-deploy-to-web-management-service-web-deploy-etc" class="hash-link" aria-label="Direct link to Example: Deploy to Web Management Service (Web Deploy etc)" title="Direct link to Example: Deploy to Web Management Service (Web Deploy etc)" translate="no">​</a></h3>
<p>This example uses netsh to update the certificate bound to port 8172 (Web Deploy etc), it then also sets the (binary) certificate hash in the registry so that the correct certificate is shown in the IIS user interface for the Web Management Service feature.</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$thumb</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># get a new guid:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$guid</span><span class="token plain"> = </span><span class="token namespace" style="color:rgb(178, 204, 214)">[guid]</span><span class="token plain">::NewGuid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># remove the previous certificate:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&amp; netsh http delete sslcert ipport=0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">0:8172</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># set the current certificate:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&amp; netsh http add sslcert ipport=0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">0:8172 certhash=</span><span class="token variable" style="color:rgb(191, 199, 213)">$thumb</span><span class="token plain"> appid=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;{</span><span class="token string variable" style="color:rgb(191, 199, 213)">$guid</span><span class="token string" style="color:rgb(195, 232, 141)">}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set registry key so Web Management Service UI in IIS matches the new certificate selection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$registryPath</span><span class="token plain"> =</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;HKLM:\Software\Microsoft\WebManagement\Server\&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$name</span><span class="token plain">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SslCertificateHash&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$hexValue</span><span class="token plain">= </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$thumb</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;(.{2})&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-ne</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;^&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0X&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$binaryHash</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token namespace" style="color:rgb(178, 204, 214)">[byte[]]</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$hexValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">New-ItemProperty</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Path </span><span class="token variable" style="color:rgb(191, 199, 213)">$registryPath</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(191, 199, 213)">$name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Value </span><span class="token variable" style="color:rgb(191, 199, 213)">$binaryHash</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">PropertyType BINARY </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">Force </span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-apply-a-certificate-to-the-default-ftp-ssl-settings-in-iis">Example: Apply a certificate to the Default FTP SSL Settings in IIS<a href="#example-apply-a-certificate-to-the-default-ftp-ssl-settings-in-iis" class="hash-link" aria-label="Direct link to Example: Apply a certificate to the Default FTP SSL Settings in IIS" title="Direct link to Example: Apply a certificate to the Default FTP SSL Settings in IIS" translate="no">​</a></h3>
<p>While the app can update a specific FTP site SSL binding for you (select Single Site under Deployment and check in the Preview tab that the ftp binding will be updated) occasionally there may be a requirement to set the global default FTP certificate settings. The following script updates the assigned default FTP certificate in IIS:</p>
<div class="language-PowerShell language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># https://learn.microsoft.com/en-us/iis/configuration/system.applicationhost/sites/sitedefaults/ftpserver/security/ssl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set the default FTP SSL certificate hash, this is a global setting and different to setting the certificate for a specific site.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">$thumb</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(191, 199, 213)">$result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManagedItem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CertificateThumbprintHash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">C:\Windows\System32\inetsrv\appcmd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">exe </span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token plain"> config </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">section:system</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">applicationHost/sites </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">siteDefaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ftpServer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">security</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ssl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">serverCertHash:</span><span class="token variable" style="color:rgb(191, 199, 213)">$thumb</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">commit:apphost</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-in-process-vs-launch-new-process">Running In-Process vs Launch New Process<a href="#running-in-process-vs-launch-new-process" class="hash-link" aria-label="Direct link to Running In-Process vs Launch New Process" title="Direct link to Running In-Process vs Launch New Process" translate="no">​</a></h2>
<p>The Powershell deployment task can run in two modes on Windows: In-Process and as a New Process. This option mainly affects the process features when the background service is attempting to run the task.</p>
<p>For in-process the service will attempt to run your task as the user you specify in an impersonation context with a specific Windows <em>LogonType</em>: <a href="https://learn.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types</a> - this affects things like reuse of credentials across network resources and the relevance varies greatly depending on what your script does and which other processes it calls into.</p>
<p>In all case you will need to test to determine the best option for your specific script. It is not always possible to get a script to work under impersonation and in those cases you may need to write out the relevant certificate variables like the thumbprint or file path then perform operations separately using your own filewatcher process or a scheduled task elsewhere.</p>
<p>Note that the <em>Launch New Process</em> option currently does not support impersonation and we aim to address this with new task runner functionality in the future.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<ul>
<li>
<p>In the Certify UI, you may test scripts by clicking the ▶ button. You should ideally test scripts after you have completed a successful certificate request so that you have real results and a certificate to work with.</p>
</li>
<li>
<p>The <code>$result.ManagedItem.CertificatePath</code> value will be set to the filename (including path) of the PFX file containing the requested certificate, unless the site is new and has not had a successful Certificate Request, in which case the value will not be set.</p>
</li>
<li>
<p>PowerShell Execution Policies may be set by your administrator which affect script execution. The app will try to set the policy to &quot;Unrestricted&quot; by default which may conflict with higher level policy settings. You can set the default script execution policy in the server settings file (then restart the Certify background service) <code>%PROGRAMDATA%\Certify\serviceconfig.json</code></p>
<ul>
<li><code>&quot;PowershellExecutionPolicy&quot;:&quot;Unrestricted&quot;</code> or</li>
<li><code>&quot;PowershellExecutionPolicy&quot;:&quot;Bypass&quot;</code> or</li>
<li><code>&quot;PowershellExecutionPolicy&quot;:&quot;&quot;</code> (blank string) to use the default policy set by your administrator.</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/webprofusion/certify-docs/edit/master/docs/script-hooks.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/deployment/tasks_intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deployment Tasks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/apache-nginx"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Apache, nginx etc</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#scripting-basics" class="table-of-contents__link toc-highlight">Scripting Basics</a></li><li><a href="#pre-request-tasks" class="table-of-contents__link toc-highlight">Pre-Request Tasks</a></li><li><a href="#deployment-tasks-post-request" class="table-of-contents__link toc-highlight">Deployment Tasks (Post-Request)</a><ul><li><a href="#example-output-the-result-properties-to-a-text-file" class="table-of-contents__link toc-highlight">Example: Output the result properties to a text file</a></li><li><a href="#example-send-email-via-gmail-after-unsuccessful-renewal" class="table-of-contents__link toc-highlight">Example: Send email via Gmail after unsuccessful renewal</a></li><li><a href="#example-restart-rras-after-successful-certificate-renewal" class="table-of-contents__link toc-highlight">Example: Restart RRAS after successful certificate renewal</a></li><li><a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" class="table-of-contents__link toc-highlight">Example: Convert CNG certificate storage to CSP (for Exchange 2013)</a></li><li><a href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" class="table-of-contents__link toc-highlight">Example: Enable certificate for Exchange 2013 / 2016 services on local server</a></li><li><a href="#example-update-vmware-horizon-certificate" class="table-of-contents__link toc-highlight">Example: Update VMWare Horizon certificate</a></li><li><a href="#example-update-sql-server-connection-certificate" class="table-of-contents__link toc-highlight">Example: Update SQL Server connection certificate</a></li><li><a href="#example-update-sql-server-reporting-services" class="table-of-contents__link toc-highlight">Example: Update SQL Server Reporting Services</a></li><li><a href="#example-setting-private-key-read-permission-for-a-specific-account" class="table-of-contents__link toc-highlight">Example: Setting private key read permission for a specific account</a></li><li><a href="#example-update-the-certificate-on-a-local-winrm-https-listener-windows-admin-center-etc" class="table-of-contents__link toc-highlight">Example: Update the certificate on a local WinRM https listener (Windows Admin Center etc)</a></li><li><a href="#example-convert-pfx-to-java-key-store-using-keytool" class="table-of-contents__link toc-highlight">Example: Convert PFX to Java Key Store using keytool</a></li><li><a href="#example-deploy-to-web-management-service-web-deploy-etc" class="table-of-contents__link toc-highlight">Example: Deploy to Web Management Service (Web Deploy etc)</a></li><li><a href="#example-apply-a-certificate-to-the-default-ftp-ssl-settings-in-iis" class="table-of-contents__link toc-highlight">Example: Apply a certificate to the Default FTP SSL Settings in IIS</a></li></ul></li><li><a href="#running-in-process-vs-launch-new-process" class="table-of-contents__link toc-highlight">Running In-Process vs Launch New Process</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Certify Certificate Manager</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dashboard">Certify Dashboard</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dns/providers/certifydns">Certify DNS</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features">Features</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/support">Support</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/webprofusion/certify" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://certifytheweb.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">certifytheweb.com<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/webprofusion/certify" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/certifytheweb" target="_blank" rel="noopener noreferrer" class="footer__link-item">X.com<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Webprofusion Pty Ltd. Docs Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>